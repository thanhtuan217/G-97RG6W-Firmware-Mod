<% PrintTemplate1(); %>
<style type="text/css">
</style>
<script type="text/javascript">
//<![CDATA[

var diag_state = 0;
var wan_list = [];
var wanIndex = 0;
var stat1_list = [];
var send = "";
var recv= "";
var lost = "";
var trip_min = "";
var trip_max = "";
var trip_ave = "";

<% GetRouterWan(); %>
<% ping_GetConfig(); %>

function showWanList()
{
	var i;
	for (i = 0; i < wan_list.length; i++)
	{
		$("#wanIndex").append("<option value=\"" + (parseInt(wan_list[i].index) + 1) + "\">" + wan_list[i].name + "<\/option>");
	}

	$("#wanIndex").append("<option value=\"0\">br0<\/option>");
}

function freshState()
{
	$.each(stat1_list,function(wid,wel){
		$("#stat1_list").append("<tr><td>" + wel.replyip + "</td><td>" + wel.bytes + "</td><td>" + wel.time + "</td><td>" + wel.ttl +"</td></tr>");
	});
}

function WebDoSubmit()
{
	var url_or_ip;
	
	if(1 == top.ping_btn_flag)
	{
		alert(WebString.pinging_alert);
		return;
	}

	if($("#packet_size").val() < 4 || $("#packet_size").val() > 1472)
	{
		alert(WebString.ping_packet_alert);
		return;
	}
	
	if($("#ping_count").val() < 1 || $("#ping_count").val() > 100)
	{
		alert(WebString.ping_count_alert);
		return;
	}

	url_or_ip = $("#url_or_ip").val();
	if(url_or_ip == "")
	{
		alert(WebString.ping_alert);
		return;
	}
	if (false == isValidUrl(url_or_ip) && false == isValidIpAddress6(url_or_ip) && false == isValidIpAddress(url_or_ip)){
		alert(WebString.ping_alert);
		return;	
	}
	
	$("#btn_ping").removeClass("btn").addClass("btn_gray");
	top.ping_btn_flag = 1;

	$("#XForm").submit();
}

function WebInit()
{
	if (top.WebShowIpv6)
	{
		$("#ip_ver").show();
	}
	showWanList();
	freshState();
	WebStepIndex();
	
	if (1 == diag_state)
	{
		$("#btn_ping").removeClass("btn").addClass("btn_gray");
		setTimeout(function(){window.location.href = window.location.href;}, 5000);
	}
	else if(2 == diag_state)
	{
		$("#btn_ping").removeClass("btn_gray").addClass("btn");
		top.ping_btn_flag = 0;
		$("#stat2_list").append("<tr><td>" + send + "</td><td>" + recv + "</td><td>" + 
			lost + "</td><td>" + trip_min + "</td><td>" + trip_max + "</td><td>" + trip_ave +"</td></tr>");
	}
}

$(document).ready(function () {
	$("#btn_ping").click(function(){
		XDoSubmit();
	});
});

//]]>
</script>
<% PrintTemplate2(); %>

<div class="cfgstep">
	<p><strong id="XS0"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS1"></td>
			<td>
				<select name="wanIndex" id="wanIndex" width="350">
				</select>
			</td>
		</tr>
	</table>
</div>

<div class="cfgstep" id="ip_ver" style="display:none">
	<p><strong id="XS2"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS3"></td>
			<td><input type="radio" name="iptype" id="select_ipv4" value="0" checked />IPv4&nbsp;&nbsp;
				<input type="radio" name="iptype" id="select_ipv6" value="1" />IPv6</td>
		</tr>
	</table>
</div>

<div class="cfgstep">
	<p><strong id="XS4"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS5"></td>
			<td><input type="text" name="url_or_ip" id="url_or_ip" maxlength="128" size="40" onkeypress="return OnKeyPress(event, X_INPUT_URL);" />
			<br /><script type="text/javascript">document.write(XpingString[23]);</script></td>
		</tr>
	</table>
</div>

<div class="cfgstep">
	<p><strong id="XS6"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS7"></td>
			<td><input type="text" name="packet_size" id="packet_size" maxlength="4" size="6" style="ime-mode: disabled;" value="56" onkeypress="return OnKeyPress(event, X_INPUT_NUM);" />(4-1472)</td>
		</tr>
	</table>
</div>

<div class="cfgstep">
	<p><strong id="XS8"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS9"></td>
			<td><input type="text" name="ping_count" id="ping_count" maxlength="3" size="6" style="ime-mode: disabled;" value="4" onkeypress="return OnKeyPress(event, X_INPUT_NUM);" />(1-100)</td>
		</tr>
	</table>
</div>

<div class="cfgstep">
	<p><strong id="XS10"></strong></p>
	<a id="btn_ping" class="btn apply_btn" href="#"><script>document.write(WebString.TTest);</script></a>
</div>

<div>
	<div class="cfglist">
		<table id="stat1_list">
			<tr>
				<th colspan="4" class="tableTitle" id="XS11"></th>
			</tr>
			<tr>
				<th id="XS12"></th>
				<th id="XS13"></th>
				<th id="XS14"></th>
				<th id="XS15"></th>
			</tr>
		</table>
	</div>
	<div class="cfglist">
		<table id="stat2_list">
			<tr>
				<th colspan="6" class="tableTitle" id="XS16"></th>
			</tr>
			<tr>
				<th id="XS17"></th>
				<th id="XS18"></th>
				<th id="XS19"></th>
				<th id="XS20"></th>
				<th id="XS21"></th>
				<th id="XS22"></th>
			</tr>
		</table>
	</div>
</div>
<% PrintTemplate3(); %>