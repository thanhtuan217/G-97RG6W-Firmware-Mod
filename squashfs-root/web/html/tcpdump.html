<% PrintTemplate1(); %>
<script type="text/javascript" src="script/json2.js"></script>
<style type="text/css">
</style>
<script type="text/javascript">
//<![CDATA[

var port_list = 9;
var tcpdump_count = 24;
var tcpdump_state = 0;
var save_file = "";
var stopdump_flag = 0;
var wan_list = [];
var applyType = 0;

var wanConfig = new Array();
var bridge = new Array();
var FiltersData = new Array();
var num_con = 0;
var MAX_NUM = 8;
var wan_num = 0;
var legalbrgportmap = 0;
var portmap_f = 0;

var ssid_list = new Array([4]);

var wifi_24g_enable = 0;
var wifi_58g_enable = 0;
var ssid_enable = new Array([4]);
var ssid5_enable = new Array([4]);
var ssid_network_name = new Array([4]);

<% GetRouterWan(); %>
<% Tcpdump_GetConfig(); %>
<% GetWanNum(); %>
<% Bridge_GetConfig(); %>
<% Diag_WIFI_SSID_GetCfg(); %>
<% Diag_WIFI5_SSID_GetCfg(); %>

function showWanList()
{
    var i;
    for (i = 0; i < wan_list.length; i++)
    {
        $("#port_list").append("<option value=\"" + (parseInt(wan_list[i].index) + 1) + "\">" + wan_list[i].name + "<\/option>");
    }
    $("#port_list").append("<option value=\"0\">br0<\/option>");
}

function showLanPortList()                                                                                                               
{                                                                                                                                        
    for(var i = 0; i < lanPorts.length; i++ ) {                     
        if (parseInt(legalbrgportmap) & (1<< port_val[i]))
        {                                                 
            if (i >= 4 && i <= 7) {                      
            	if (wifi_24g_enable == '0' || ssid_enable[i-4] == '0')
                	continue;               
            }                                               
            if (i >= 8 && i <= 11) {                      
            	if (wifi_58g_enable == '0' || ssid5_enable[i-8] == '0')
                	continue;               
            }                                               
                                                            
            if (i >=0 && i <=3)                                                       
            {                                                                                                                            
                $("#port_list").append("<option value=\"" + (parseInt(port_val[i]) + 9) + "\">" + lanPorts[i] + "<\/option>");           
            }                                                                                                                            
            else                                                                                                                         
            {                                                                                                                 
                $("#port_list").append("<option value=\"" + (parseInt(port_val[i])) + "\">" + lanPorts[i] + "<\/option>");    
            }                                                                                                                 
            portmap_f = 1;                                                                                                    
        }                                                                                                                     
    }                                                                                                                     
}                                                                                                                         


function WebDoSubmit()
{
    if (1 == $("#applyType").val())
    {
		if(1 == top.tcpdump_btn_flag)
		{
			alert(WebString.tcpdumping_alert);
			return;
		}

		if($("#tcpdump_count").val() < 1 || $("#tcpdump_count").val() > 2000)
		{
			alert(WebString.tcpdump_count_alert);
			return;
		}

		$("#btn_tcpdump").removeClass("btn").addClass("btn_gray");
		$("#btn_save").removeClass("btn").addClass("btn_gray");		
		top.tcpdump_btn_flag = 1;
    	$("#XForm").submit();
    }
    else if (2 == $("#applyType").val())
    {	if(1 == top.stopdump_btn_flag)
		{
			return;
		}
	    if (1 != tcpdump_state) {
	    	return;
        }

  		$("#btn_stopdump").removeClass("btn").addClass("btn_gray");	
 		top.stopdump_btn_flag = 1;
	    $("#XForm").submit();
    }
}

function WebInit()
{
	showWanList();
	showLanPortList();
	WebStepIndex();

    $("#port_list").val(port_list);
    $("#tcpdump_count").val(tcpdump_count);

	if (1 == tcpdump_state)
	{
		$("#btn_tcpdump").removeClass("btn").addClass("btn_gray");
		$("#btn_save").removeClass("btn").addClass("btn_gray");
		$("#btn_stopdump").removeClass("btn_gray").addClass("btn");

		//$("#btn_tcpdump").attr("disabled",true);
		//$("#btn_save").attr("disabled",true);
		setTimeout(function(){window.location.href = window.location.href;}, 5000);
	}
	else if(2 == tcpdump_state)
	{
		$("#btn_tcpdump").removeClass("btn_gray").addClass("btn");
		$("#btn_save").removeClass("btn_gray").addClass("btn");		
   		$("#btn_stopdump").removeClass("btn").addClass("btn_gray");

		//$("#btn_tcpdump").attr("disabled",false);
		//$("#btn_save").attr("disabled",false);
		top.tcpdump_btn_flag = 0;
 		top.stopdump_btn_flag = 0;

	}
	else if (3 == tcpdump_state)
	{
		$("#btn_tcpdump").removeClass("btn").addClass("btn_gray");
		$("#btn_save").removeClass("btn").addClass("btn_gray");
		$("#btn_stopdump").removeClass("btn").addClass("btn_gray");

		//$("#btn_tcpdump").attr("disabled",true);
		//$("#btn_save").attr("disabled",true);
		setTimeout(function(){window.location.href = window.location.href;}, 5000);
	}
	else
	{
		//$("#btn_tcpdump").attr("disabled",false);
		//$("#btn_save").attr("disabled",true);
		$("#btn_tcpdump").removeClass("btn_gray").addClass("btn");
    	$("#btn_save").removeClass("btn").addClass("btn_gray");		
   		$("#btn_stopdump").removeClass("btn").addClass("btn_gray");
	}
}

$(document).ready(function () {
	$("#btn_tcpdump").click(function(){
	    $("#applyType").val('1');
		XDoSubmit();
	});

	$("#btn_save").click(function() {
    	if(1 != top.tcpdump_btn_flag)
	    {
	        if(save_file == "") {
	            alert(XtcpdumpString[6]);
	        }else {
	            window.location.href = save_file;
	        }
	    }
	});

	$("#btn_stopdump").click(function(){
	    $("#applyType").val('2');
		XDoSubmit();
	});

	
});

//]]>
</script>
<% PrintTemplate2(); %>

<div class="cfgstep">
	<p><strong id="XS0"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS1"></td>
			<td>
				<select name="port_list" id="port_list" width="350">
				</select>
			</td>
		</tr>
	</table>
</div>

<div class="cfgstep">
	<p><strong id="XS2"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS3"></td>
			<td><input type="text" name="tcpdump_count" id="tcpdump_count" maxlength="4" size="6" style="ime-mode: disabled;" value="10" onkeypress="return OnKeyPress(event, X_INPUT_NUM);" />(1-2000)</td>
		</tr>
	</table>
</div>

<div class="cfgstep">
	<p><strong id="XS4"></strong></p>
	<table>
		<tr>
			<td><a id="btn_tcpdump" class="btn apply_btn" href="#"><script>document.write(WebString.Start);</script></a></td>
			<td><a id="btn_stopdump" class="btn apply_btn" href="#"><script type="text/javascript">document.write(WebString.Stop);</script></a></td>
		</tr>
	</table>
</div>


<div class="cfgstep">
	<p><strong id="XS5"></strong></p>
 	<table>
		<tr>
            <td><a id="btn_save" class="btn apply_btn" href="#"><script>document.write(WebString.Save);</script></a></td>
		</tr>
	</table>
</div>

<div class="cfgstep" style="display:none">
	<p><strong id="XS2"></strong></p>
	<table>
		<tr>
			<td width="200" id="XS3"></td>
			<td><input type="text" name="applyType" id="applyType" maxlength="4" size="6" style="ime-mode: disabled;" value="0" onkeypress="return OnKeyPress(event, X_INPUT_NUM);" /></td>
		</tr>
	</table>
</div>

<% PrintTemplate3(); %>
