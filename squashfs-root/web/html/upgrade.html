<% PrintTemplate1(); %>
<style type="text/css">
	
#up_img {
	filter: alpha(opacity:0);
	opacity: 0;
}

.type-file-text {
	border: 1px solid #cdcdcd;
}

.type-file-button {
	background-color: #fff;
	border: 1px solid #cdcdcd;
}

</style>
<script type="text/javascript">
//<![CDATA[
var upgd_flag = 0;
var	firm_ver = "";
var values = "";
var i = 0;

<% upgrade_GetConfig(); %>

function updateProcess()
{
	if(i < 99)
	{
		i = i + 1;
		values =  WebString.upgrading + i + "%";
		document.getElementById('myProcess').innerHTML = values;
	}
	else
	{
		window.location.href = window.location.href;
	}
}

function WebDoSubmit()
{
	if($("#up_img").val() == "")
	{
		alert(WebString.upgrade_alert);
		$("#up_img").focus();
		return;
	}
	if(!confirm(WebString.upgrading_alert))
	{
		return;
	}

	$("#div_up_file").hide();
	$("#div_wirte_firmware").hide();
	$("#div_upload_file").show();
	$("#XForm").attr("enctype", "multipart/form-data");
	$("#XForm").submit();
}

function WebInit()
{
	$("#firm_ver").html(firm_ver);
	$("#div_upload_file").hide();
	$("#div_error").hide();
	
	if(0 == upgd_flag)
	{
		$("#div_up_file").show();
		$("#div_wirte_firmware").hide();
	}
	else if(1 == upgd_flag)
	{
		setInterval("updateProcess();", 1600);
		$("#div_up_file").hide();
		$("#div_wirte_firmware").show();
	}
	else if(2 == upgd_flag)
	{
		$("#div_up_file").hide();
		$("#div_wirte_firmware").hide();
		$("#div_error").show();
	}
	
	WebStepIndex();
}

$(document).ready(function () {
	$("#up_img").offset({top:-1000,left:-1000});
	$("#up_img_button").val(WebString.browse);
	var navigatorName = "Microsoft Internet Explorer"; 
	if(navigator.appName == navigatorName)
	{
		$(document).mousemove(function(e){
			var pos = $("#up_img_button").offset();
			var bright = pos.left + $("#up_img_button").width() + 16;
			var bbuttom = pos.top + $("#up_img_button").height() + 2;
			if(e.pageX >= pos.left && e.pageX <= bright && e.pageY >= pos.top && e.pageY <= bbuttom)
			{
				$("#up_img").offset({top:e.pageY-10,left:e.pageX-50});
			}
			else
			{
				$("#up_img").offset({top:-1000,left:-1000});
			}
		});
	}
	else
	{
		$("#up_img_button").click(function(){
			$("#up_img").focus();
			$("#up_img").trigger("click");
		});
	}

	$("#up_img").change(function(){
		if($("#up_img").val() != null)              
		{
			var filepath = $("#up_img").val();
			var filename = filepath.substr(filepath.lastIndexOf('\\')+1);
			$("#up_img_text").val(filename);
		}
	});
	
	$("#btn_upgrade").click(function(){
		XDoSubmit();
	});
});

//]]>
</script>
<% PrintTemplate2(); %>
<input type="file" id="up_img" name="up_img" size="1" />
<div id="div_up_file">
	<div class="cfgstep">
		<table>
			<tr>
				<td id="XS0" width="200"></td>
				<td id="firm_ver"></td>
			</tr>
		</table>
	</div>
	
	<div class="cfgstep">
		<p><strong id="XS1"></strong></p>
		<table>
			<tr>
				<td>
					<input type="text" id="up_img_text" class="type-file-text" readonly="readonly" />
					<input type="button" id="up_img_button" class="type-file-button" />
				</td>
			</tr>
		</table>
	</div>
	
	<div class="cfgstep">
		<p><strong><script>document.write(WebString.stepUpgrade);</script></strong></p>
		<a id="btn_upgrade" class="btn apply_btn" href="#"><script>document.write(WebString.Upgrade);</script></a>
	</div>
</div>

<div id="div_wirte_firmware">
	<div class="cfgstep">
		<p><strong id="XS2"></strong></p>
		<table>
			<tr>
				<td id="myProcess"></td>
			</tr>
		</table>
	</div>
</div>

<div id="div_upload_file">
	<div class="cfgstep">
		<p><strong id="XS3"></strong></p>
		<table>
			<tr>
				<td id="XS4"></td>
			</tr>
		</table>
	</div>
</div>

<div id="div_error">
	<div class="cfgstep">
		<p><strong id="XS5"></strong></p>
		<table>
			<tr>
				<td id="XS6"></td>
			</tr>
		</table>
	</div>
</div>
<% PrintTemplate3(); %>