<% PrintTemplate1(); %>
<style type="text/css">
</style>
<script type="text/javascript">
//<![CDATA[

var lan_ip = "";
var lan_mask = "";
var dhcp_enable = 1;
var pooltype = 0;
var dhcp_lease_time = 0;
var pool_count = 0;
var pool_enable = 0;
var dns_mode = 0;
var manual_dns1 = "";
var manual_dns2 = "";

var AddrPoolData = new Array();
var addrpool_list = new Array();
var pool = new Array();

//unimode,  bridge port:0, router port:1
var eth1 = 0;   
var eth2 = 0;
var eth3 = 0;
var eth4 = 0;
var num_lan = 2;
var workMode = 0;

<% LAN_GetConfig(); %>
<% LanPort_GetConfig(); %>

function dataInit()
{
    $("#lan_ip").val(lan_ip);
    $("#lan_mask").val(lan_mask);
    $("#start_ip").val(addrpool_list[0].startip);
    $("#end_ip").val(addrpool_list[0].endip);
    $("#dns_primary").val(manual_dns1);
    $("#dns_secondary").val(manual_dns2);
    $("#time_day").val( parseInt(dhcp_lease_time/(24*60)) );
    $("#time_hour").val( parseInt(dhcp_lease_time%(24*60)/(60)) );
    $("#time_minu").val( parseInt(dhcp_lease_time%60) );
    if (1 == dhcp_enable)
        $("#dhcp_enable0").attr("checked", true);
    else
        $("#dhcp_enable1").attr("checked", true);

    if (0 == pooltype)
        $("#mode0").attr("checked", true);
    else if(1 == pooltype)
        $("#mode1").attr("checked", true);
    else
        $("#mode2").attr("checked", true);
      
    if (1 == dns_mode)
        $("#dns_ovwrt0").attr("checked", true);
    else
        $("#dns_ovwrt1").attr("checked", true);
    if(1 < pool_count)
        $("#multaddr_enable0").attr("checked", true);
    else
        $("#multaddr_enable1").attr("checked", true);     
}

function uniModeInit()
{
    if(0 == eth2)
        $("#lan2").attr("disabled", true);
    if(0 == eth3)
        $("#lan3").attr("disabled", true);
    if(0 == eth4)
        $("#lan4").attr("disabled", true);    
}

function dhcpserver_enable()
{
    var val = $('input:radio[name="dhcp_enable"]:checked').val();
    var mode = $('input:radio[name="pool_mode"]:checked').val();
    $("#multipool_info").hide();
    
    if(1 == val)
    {
        $("#default_addr_range_div").show();
        $("#multiple_addrpool_div").show();
        $("#dhcp_leasetime_div").show();
        $("#dns_overwrite_div").show();
        if(1 == mode)
        {
            $("#multiple_addrpool_div").show();
            $("#MultAddrPoolTableContainer").show();
        }
        else
        {
            $("#multiple_addrpool_div").hide();
            $("#MultAddrPoolTableContainer").hide();
            $("#addrpooltable").val("");             
        }
    }
    else
    {
        $("#default_addr_range_div").hide();
        $("#multiple_addrpool_div").hide();
        $("#dhcp_leasetime_div").hide();
        $("#dns_overwrite_div").hide();
        $("#start_ip").val(addrpool_list[0].startip);
        $("#end_ip").val(addrpool_list[0].endip);
        $("#addrpooltable").val("");         
        $("#leasetime").val("0");
        $("#multaddr_enable1").attr("checked", true);
        $("#dns_ovwrt1").attr("checked", true);
    }
    if(2 == mode)
    {
        $("#multipool_info").show();
    }
    WebStepIndex();
}

function dns_overwrite_manual()
{
    var val=$('input:radio[name="dns_overwrite"]:checked').val();    
    if(1 == val)
    {      
        $("#primary_dns").show();
        $("#secondary_dns").show();
        if( "" == manual_dns1)
            $("#primary_dns").val($("#lan_ip").val());
        else
            $("#primary_dns").val(manual_dns1);
    }
    else
    {
        $("#primary_dns").hide();
        $("#secondary_dns").hide();
        $("#dns_primary").val("");
        $("#dns_secondary").val("");
    }
}


/*  cig_rg_common.h define
   // 0xfffffff, last 4 bits is LAN1-4, LAN:16bits, ssid:8bits * 2
typedef enum {
    RG_UNI_LAN1         = 0,
    RG_UNI_LAN2         = 1,
    RG_UNI_LAN3         = 2,
    RG_UNI_LAN4         = 3,
    //
    RG_UNI_RF0_SSID1    = 16,  //2.4G
    RG_UNI_RF0_SSID2    = 17,
    RG_UNI_RF0_SSID3    = 18,
    RG_UNI_RF0_SSID4    = 19,
    RG_UNI_RF1_SSID1    = 24, //5G
    RG_UNI_RF1_SSID2    = 25,
    RG_UNI_RF1_SSID3    = 26,
    RG_UNI_RF1_SSID4    = 27,
    RG_UNI_MAX          = 32,
} RG_UNI_E;
*/

function MultAddrTableFresh()
{
    var TR = "";
    TR += '<table id="MultAddrTable" class="commonlist">\n';
    TR += '<tr>\n';
    TR += '<th style="width: 35%;">' + XlanString[18] + '</th>\n';
    TR += '<th style="width: 25%;">' + XlanString[19] + '</th>\n';
    TR += '<th style="width: 25%;">' + XlanString[20] + '</th>\n';
    TR += '<th style="width: 15%;">' + WebString.Edit + '</th>\n';
    TR += '</tr>\n';
    var post_str="";

    for (var i = 0; i < AddrPoolData.length; i++)
    {
        var lanif = AddrPoolData[i].lanif;
        var startip = AddrPoolData[i].startip;
        var endip = AddrPoolData[i].endip;
        //var leasetime = AddrPoolData[i].leasetime;
        var ifname = "";
        if(lanif & (1 << 0))
            ifname += "LAN1 ";
        if(lanif & (1 << 1))
            ifname += "LAN2 ";
        if(lanif & (1 << 2))
            ifname += "LAN3 "; 
        if(lanif & (1 << 3))
            ifname += "LAN4 ";
        if(lanif & (1 << 16))
            ifname += "2.4G_SSID1 ";
        if(lanif & (1 << 17))
            ifname += "2.4G_SSID2 ";
        if(lanif & (1 << 18))
            ifname += "2.4G_SSID3 "; 
        if(lanif & (1 << 19))
            ifname += "2.4G_SSID4 "; 
        if(lanif & (1 << 24))
            ifname += "5G_SSID1 "; 
        if(lanif & (1 << 25))
            ifname += "5G_SSID2 "; 
        if(lanif & (1 << 26))
            ifname += "5G_SSID3 "; 
        if(lanif & (1 << 27))
            ifname += "5G_SSID4 ";

        post_str=post_str + lanif + "|";
        post_str=post_str + startip + "|";
        post_str=post_str + endip + "~";
       // post_str=post_str + leasetime + "~";

        TR += '<tr>\n';
        TR += '<td>' + ifname + '</td>\n';
        TR += '<td>' + startip + '</td>\n';
        TR += '<td>' + endip + '</td>\n';
        TR += '<td><a href="#" class="btn remove_btn" onclick="DeleteIpSelected(this);" >' + WebString.Remove + '</a></td>';
        TR += '</tr>\n';        
    }    
    
    TR += '</table>\n';
    $("#MultAddrPoolTableContainer").html(TR);
    $("#addrpooltable").val(post_str);
    
    WebStyleCommonList();
}

function DeleteIpSelected(r)
{
    WebResetTimer();

    var row = r.parentNode.parentNode.rowIndex;
    var len = AddrPoolData.length;
    for (var i = row-1; i < AddrPoolData.length; i++ )
    {
        AddrPoolData[i] = AddrPoolData[i+1];
    }
    AddrPoolData.pop();
    MultAddrTableFresh();
}

function IpAddrPoolBind()
{  
    WebResetTimer();

    var obj = new Object();
    var leasetime = 0; 
    var lanif = 0; 
    var pool_lan_ip = Ip2Num($("#lan_ip").val());
    var pool_lan_mask = Ip2Num($("#lan_mask").val());
    var ip_start_def = Ip2Num($("#start_ip").val());
    var ip_end_def = Ip2Num($("#end_ip").val());
    var pool_ip_start = Ip2Num($("#dhcp_start_ip").val());
    var pool_ip_end = Ip2Num($("#dhcp_end_ip").val());
    var pool_subnet = (pool_lan_ip & pool_lan_mask);        

    if(AddrPoolData.length >= 3)
    {
        alert(WebString.dhcp_pool_max_num);
        return false;
    }

    if( !isValidIpAddress($("#dhcp_start_ip").val()) || !isValidIpAddress($("#dhcp_end_ip").val()) )
    {
        alert(WebString.ip_alert);
        return false;
    }     
    
    if (false == isValidUnicastIpAddress($("#dhcp_start_ip").val(), $("#lan_mask").val())
    || false == isValidUnicastIpAddress($("#dhcp_end_ip").val(), $("#lan_mask").val()))
    {
        alert(WebString.unicastip);
        return false;
    }
    
    if(pool_lan_ip == pool_ip_start || pool_lan_ip == pool_ip_end)
    {
        alert(WebString.ip_conflict);
        return false;	
    }
         
    if (pool_subnet != (pool_ip_start & pool_lan_mask))
    {
        alert(WebString.diff_subnet);
        return false;
    }
    if (pool_subnet != (pool_ip_end & pool_lan_mask))
    {
        alert(WebString.diff_subnet);
        return false;
    }

    if(pool_ip_start > pool_ip_end)
    {
        alert(WebString.addr_beyond);
        return false;
    }

    if(pool_ip_start >= ip_start_def && pool_ip_start <= ip_end_def ||
        pool_ip_end >= ip_start_def && pool_ip_end <= ip_end_def)
    {
        alert(WebString.pool_addr_cross);
        return false;
    }
    if(pool_ip_start <= ip_start_def && pool_ip_end >= ip_end_def)
    {
        alert(WebString.invalid_ip_range);
        return false;
    }
    
    for (var i = 0; i < AddrPoolData.length; i++ )
    {
        if(pool_ip_start >= Ip2Num(AddrPoolData[i].startip) && pool_ip_start <= Ip2Num(AddrPoolData[i].endip) ||
        pool_ip_end >= Ip2Num(AddrPoolData[i].startip) && pool_ip_end <= Ip2Num(AddrPoolData[i].endip))
        {
            alert(WebString.pool_addr_cross);
            return false;
        }
        if(pool_ip_start <= Ip2Num(AddrPoolData[i].startip) && pool_ip_end >= Ip2Num(AddrPoolData[i].endip))
        {
            alert(WebString.invalid_ip_range);
            return false;
        }
    }
    
    if($("#lan1").attr("disabled") == undefined && $("#lan1").attr("checked") != undefined)
    {
        lanif |= (1 << 0);
    }
    if($("#lan2").attr("disabled") == undefined && $("#lan2").attr("checked") != undefined)
    {
        lanif |= (1 << 1);
    }
    if($("#lan3").attr("disabled") == undefined && $("#lan3").attr("checked") != undefined)
    {
        lanif |= (1 << 2);      
    }    
    if($("#lan4").attr("disabled") == undefined && $("#lan4").attr("checked") != undefined)
    {
        lanif |= (1 << 3);
    }    
    if($("#ssid1_24g").attr("disabled") == undefined && $("#ssid1_24g").attr("checked") != undefined)
    {
        lanif |= (1 << 16);
    }
    if($("#ssid2_24g").attr("disabled") == undefined && $("#ssid2_24g").attr("checked") != undefined)
    {
        lanif |= (1 << 17);
    }
    if($("#ssid3_24g").attr("disabled") == undefined && $("#ssid3_24g").attr("checked") != undefined)
    {
        lanif |= (1 << 18);      
    }    
    if($("#ssid4_24g").attr("disabled") == undefined && $("#ssid4_24g").attr("checked") != undefined)
    {
        lanif |= (1 << 19);
    }
    if($("#ssid1_5g").attr("disabled") == undefined && $("#ssid1_5g").attr("checked") != undefined)
    {
        lanif |= (1 << 24);
    }    
    if($("#ssid2_5g").attr("disabled") == undefined && $("#ssid2_5g").attr("checked") != undefined)
    {
        lanif |= (1 << 25);
    }
    if($("#ssid3_5g").attr("disabled") == undefined && $("#ssid3_5g").attr("checked") != undefined)
    { 
        lanif |= (1 << 26);
    }
    if($("#ssid4_5g").attr("disabled") == undefined && $("#ssid4_5g").attr("checked") != undefined)
    {
        lanif |= (1 << 27);
    }
    if(0 == lanif)
    {
        alert(WebString.port_select);
        return false;
    }
    else
    {
        if(lanif & (1 << 0))
        {
            $("#lan1").attr("checked", true);
            $("#lan1").attr("disabled", true);
        }
        if(lanif & (1 << 1))
        {
            $("#lan2").attr("checked", true);
            $("#lan2").attr("disabled", true);
        }
        if(lanif & (1 << 2))
        {
            $("#lan3").attr("checked", true);
            $("#lan3").attr("disabled", true);
        }
        if(lanif & (1 << 3))
        {
            $("#lan4").attr("checked", true);
            $("#lan4").attr("disabled", true);
        }
        if(lanif & (1 << 16))
        {
            $("#ssid1_24g").attr("checked", true);
            $("#ssid1_24g").attr("disabled", true);
        }
        if(lanif & (1 << 17))
        {
            $("#ssid2_24g").attr("checked", true);
            $("#ssid2_24g").attr("disabled", true);
        }
        if(lanif & (1 << 18))
        {
            $("#ssid3_24g").attr("checked", true);
            $("#ssid3_24g").attr("disabled", true);
        }
        if(lanif & (1 << 19))
        {
            $("#ssid4_24g").attr("checked", true);
            $("#ssid4_24g").attr("disabled", true);
        }
        if(lanif & (1 << 24))
        {
            $("#ssid1_5g").attr("checked", true);
            $("#ssid1_5g").attr("disabled", true);
        }
        if(lanif & (1 << 25))
        {
            $("#ssid2_5g").attr("checked", true);
            $("#ssid2_5g").attr("disabled", true);
        }
        if(lanif & (1 << 26))
        {
            $("#ssid3_5g").attr("checked", true);
            $("#ssid3_5g").attr("disabled", true);
        }
        if(lanif & (1 << 27))
        {
            $("#ssid4_5g").attr("checked", true);
            $("#ssid4_5g").attr("disabled", true);
        }
    }
    
    obj.lanif = lanif;
    obj.startip = $("#dhcp_start_ip").attr("value");
    obj.endip = $("#dhcp_end_ip").attr("value");
    obj.leasetime = leasetime;
    AddrPoolData.push(obj);
    MultAddrTableFresh();
}

function BindMutilAddrPoolValue()
{
    this.lanif;
    this.startip;
    this.endip;
    //this.leasetime;
}

function InitTable()
{
    var i = 0;
    var j = 0;
    for(i = 0; i < parseInt(pool_count) - 1; i++)
    {
        //pool[0] for default(2. Enter the DHCP address pool definition.)
        j = i + 1;
        AddrPoolData[i]=new BindMutilAddrPoolValue();
        AddrPoolData[i].lanif = addrpool_list[j].lanif;
        AddrPoolData[i].startip = addrpool_list[j].startip;
        AddrPoolData[i].endip = addrpool_list[j].endip;
        //AddrPoolData[i].leasetime = addrpool_list[j].leasetime;
        
        var lan_if = addrpool_list[j].lanif;
        if(lan_if & (1 << 0))
        {
            $("#lan1").attr("checked", true);
            $("#lan1").attr("disabled", true);
        }
        if(lan_if & (1 << 1))
        {
            $("#lan2").attr("checked", true);
            $("#lan2").attr("disabled", true);
        }
        if(lan_if & (1 << 2))
        {
            $("#lan3").attr("checked", true);
            $("#lan3").attr("disabled", true);
        }
        if(lan_if & (1 << 3))
        {
            $("#lan4").attr("checked", true);
            $("#lan4").attr("disabled", true);
        }
        if(lan_if & (1 << 16))
        {
            $("#ssid1_24g").attr("checked", true);
            $("#ssid1_24g").attr("disabled", true);
        }
        if(lan_if & (1 << 17))
        {
            $("#ssid2_24g").attr("checked", true);
            $("#ssid2_24g").attr("disabled", true);
        }
        if(lan_if & (1 << 18))
        {
            $("#ssid3_24g").attr("checked", true);
            $("#ssid3_24g").attr("disabled", true);
        }
        if(lan_if & (1 << 19))
        {
            $("#ssid4_24g").attr("checked", true);
            $("#ssid4_24g").attr("disabled", true);
        }
        if(lan_if & (1 << 24))
        {
            $("#ssid1_5g").attr("checked", true);
            $("#ssid1_5g").attr("disabled", true);
        }
        if(lan_if & (1 << 25))
        {
            $("#ssid2_5g").attr("checked", true);
            $("#ssid2_5g").attr("disabled", true);
        }
        if(lan_if & (1 << 26))
        {
            $("#ssid3_5g").attr("checked", true);
            $("#ssid3_5g").attr("disabled", true);
        }
        if(lan_if & (1 << 27))
        {
            $("#ssid4_5g").attr("checked", true);
            $("#ssid4_5g").attr("disabled", true);
        }
    }   
}

function is2LanSubnetDiffer()
{
    var lanip = $("#lan_ip").val();
    var lanmask = $("#lan_mask").val();
    var lanip2 = pool[1].lan_ip;
    var lanmask2 = pool[1].lan_mask;
    var subnet1 = Ip2Num(lanip) & Ip2Num(lanmask);
    var subnet2 = Ip2Num(lanip2) & Ip2Num(lanmask2);

    if (false == isValidIpAddress(lanip))
    {
        alert(WebString.ip_alert);
        return false;
    }

    if (false == isValidSubnetMask(lanmask))
    {
        alert(WebString.netmask_alert);
        return false;
    }

    if (false == isValidUnicastIpAddress(lanip, lanmask))
    {
        alert(WebString.unicastip);
        return false;
    }

    if( subnet1 == subnet2)
    {
        alert(WebString.same_subnet);
        return false;
    }
    
    return true;
}

function LocalSubnetChange()
{
    if (false == is2LanSubnetDiffer())
    {
        return false;
    }

    if(1 == $('input:radio[name="dhcp_enable"]:checked').val())
    {        
        var n_lan_ip = Ip2Num($("#lan_ip").val()) >>> 0;
        var n_lan_mask = Ip2Num($("#lan_mask").val()) >>> 0;
        var n_ip_start = Ip2Num($("#start_ip").val()) >>> 0;
        var n_ip_end = Ip2Num($("#end_ip").val()) >>> 0;
        var n_subnet = (n_lan_ip & n_lan_mask);

        if( !isValidIpAddress($("#start_ip").val()) || !isValidIpAddress($("#end_ip").val()) )
        {
            alert(WebString.ip_alert);
            return false;
        }

        if( lan_ip != $("#lan_ip").val() && n_subnet != ((Ip2Num(lan_ip) >>> 0) & (Ip2Num(lan_mask) >>> 0)) )
        {
            alert(WebString.subnet_changed);
            var new_ipstart = n_ip_start - (n_ip_start & n_lan_mask) + n_subnet;
            var new_ipend = n_ip_end - (n_ip_end & n_lan_mask) + n_subnet;
            $("#start_ip").val(Num2Ip(new_ipstart));
            $("#end_ip").val(Num2Ip(new_ipend));
            
            if($('input:radio[name="addrpool_enable"]:checked').val())
            {
                for (var i = 0; i < AddrPoolData.length; i++ )
                {
                    var ipstart = Ip2Num(AddrPoolData[i].startip) >>> 0;
                    var ipend = Ip2Num(AddrPoolData[i].endip) >>> 0;
                    var dhcp_startip = ipstart - (ipstart & n_lan_mask) + n_subnet;
                    var dhcp_endip = ipend - (ipend & n_lan_mask) + n_subnet;
                    AddrPoolData[i].startip = Num2Ip(dhcp_startip);
                    AddrPoolData[i].endip = Num2Ip(dhcp_endip);
                }
            }
            MultAddrTableFresh();
        }
    } 
    return true;
}

function WebInit()
{
    if (top.num_5g_wifi)
    {
        $("#wifi5g").show();
    }
    dataInit(); 
    
    //if the port is l2 port, don't assign ip to this port
    uniModeInit();
    
    dhcpserver_enable();
    dns_overwrite_manual();
    InitTable();
    MultAddrTableFresh();
    WebStepIndex();

    //  hide the DHCP while SFU mode
    if (1 == workMode)
    {
        $("#dhcp_cfg_div").hide();
    }
}

$(document).ready(function (){
    $("#btn_apply").click(function(){
        XDoSubmit();
    });
    
    $("#addpool").click(function(){
        IpAddrPoolBind();
    });     

    $("input[name='dhcp_enable']").click(function() {
        dhcpserver_enable();
    });

    $("input[name='pool_mode']").click(function() {
        dhcpserver_enable();
    });

    $("input[name='dns_overwrite']").click(function() {
        dns_overwrite_manual();
    });
    
    $("input[name='lan_ip']").change(function() {
        LocalSubnetChange();
    });
    
});

function CheckSetValue()
{
    if (false == is2LanSubnetDiffer())
    {
        return false;
    }
    
    if(1 == $('input:radio[name="dhcp_enable"]:checked').val())
    {
        var n_lan_ip = Ip2Num($("#lan_ip").val()) >>> 0;
        var n_lan_mask = Ip2Num($("#lan_mask").val()) >>> 0;
        var n_ip_start = Ip2Num($("#start_ip").val()) >>> 0;
        var n_ip_end = Ip2Num($("#end_ip").val()) >>> 0;
        var n_subnet = (n_lan_ip & n_lan_mask);
        var pmode = $('input:radio[name="pool_mode"]:checked').val();

        if( !isValidIpAddress($("#start_ip").val()) || !isValidIpAddress($("#end_ip").val()) )
        {
            alert(WebString.ip_alert);
            return false;
        }
        
        if (false == isValidUnicastIpAddress($("#start_ip").val(), $("#lan_mask").val())
        || false == isValidUnicastIpAddress($("#end_ip").val(), $("#lan_mask").val()))
        {
            alert(WebString.unicastip);
            return false;
        } 
         
        if(n_lan_ip == n_ip_start || n_lan_ip == n_ip_end)
        {
            alert(WebString.ip_conflict);
            return false;	
        }      

        if (n_subnet != (n_ip_start & n_lan_mask))
        {
            alert(WebString.diff_subnet);
            return false;
        }
        if (n_subnet != (n_ip_end & n_lan_mask))
        {
            alert(WebString.diff_subnet);
            return false;
        }
       
        if(n_ip_start > n_ip_end)
        {
            alert(WebString.addr_beyond);
            return false;
        }
        
        if(1 == pmode)
        {
            for (var i = 1; i < addrpool_list.length; i++ )
            {
                if(n_ip_start >= Ip2Num(addrpool_list[i].startip) && n_ip_start <= Ip2Num(addrpool_list[i].endip) ||
                n_ip_end >= Ip2Num(addrpool_list[i].startip) && n_ip_end <= Ip2Num(addrpool_list[i].endip))
                {
                    alert(WebString.pool_addr_cross);
                    return false;
                }
                if((n_ip_start <= Ip2Num(addrpool_list[i].startip)) && (n_ip_end >= Ip2Num(addrpool_list[i].endip)))
                {
                    alert(WebString.invalid_ip_range);
                    return false;
                }
            }
        }
        
        if(1 == $('input:radio[name="dns_overwrite"]:checked').val())
        {
            var dns1 = $("#dns_primary").val();
            var dns2 = $("#dns_secondary").val();
            if(dns1.length > 0 && dns1 != "0.0.0.0")
            {
                if (false == isValidDnsIpAddress(dns1))
                {
                    alert(WebString.wan_pridns_alert);
                    return false;
                }
            }
            if(dns2.length > 0 && dns2 != "0.0.0.0")
            {
                if (false == isValidDnsIpAddress(dns2))
                {
                    alert(WebString.wan_secdns_alert);
                    return false;
                }
                if(dns1 == dns2)
                {
                    alert(WebString.wan_prisec_alert);
                    return false;
                }
            }
            if(("" == dns1 && "" == dns2) || ("0.0.0.0" == dns1 && "0.0.0.0" == dns2))
            {
                alert(WebString.dns_valid);
                return false;  
            }
            if(("" == dns1 || "0.0.0.0" == dns1) && ("" == dns2 || "0.0.0.0" == dns2))
            {
                $("#dns_primary").val($("#lan_ip").val());
                $("#dns_secondary").val("0.0.0.0");
            }             
        }
        
        var time_day = parseInt($("#time_day").attr("value"));
        var time_hour = parseInt($("#time_hour").attr("value"));
        var time_minu = parseInt($("#time_minu").attr("value"));
        if(time_day < 0 || time_day > 365)
        {
            alert(WebString.day_alert);
            return false;            
        }
        if(time_hour < 0 || time_hour > 23)
        {
            alert(WebString.hour_alert);
            return false;            
        }
        if(time_minu < 0 || time_minu > 59)
        {
            alert(WebString.minute_alert);
            return false;            
        }
        
        var dhcpleasetime = time_day * 24 * 60 + time_hour * 60 + time_minu;
        if(2 > dhcpleasetime)
        {
            alert(WebString.min_leasetime);
            return false; 
        }
        $("#leasetime").val(dhcpleasetime);
    }
               
    return true;
}

function WebDoSubmit()
{   
    if( false == CheckSetValue())
    {
        return;
    }
    $("#XForm").submit();
}


//]]>
</script>
<% PrintTemplate2(); %>

<div class="cfgstep">
    <p><strong id="XS0"></strong></p>
    <table>
        <tr>
            <td width="200" id="XS1"></td>
            <td><input type="text" name="lan_ip" id="lan_ip" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
        <tr>
            <td width="200" id="XS2"></td>
            <td><input type="text" name="lan_mask" id="lan_mask" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
    </table>
</div>
<div id="dhcp_cfg_div" class="cfgstep">
    <table>
        <tr>
            <td width="200" id="XS3"></td>
            <td><input type="radio" name="dhcp_enable" id="dhcp_enable0" value="1" checked /><script>document.write(WebString.Enable);</script>
                <input type="radio" name="dhcp_enable" id="dhcp_enable1" value="0" /><script>document.write(WebString.Disable);</script></td>
        </tr>
        <tr>
            <td width="200" id="XS21"></td>
            <td><input type="radio" name="pool_mode" id="mode0" value="0" checked /><script>document.write(WebString.pooltype0);</script><br>
                <input type="radio" name="pool_mode" id="mode1" value="1" /><script>document.write(WebString.pooltype1);</script><br>
                <input type="radio" name="pool_mode" id="mode2" value="2" /><script>document.write(WebString.pooltype2);</script></td>
        </tr>
        <tr id="multipool_info" style="display:none">
            <td width="200" id="XS22" colspan="2" style="font-weight: bold"></td>
        </tr>
    </table>
</div>

<div id="default_addr_range_div" class="cfgstep">
    <p><strong id="XS4"></strong></p>
    <table>
        <tr>
            <td width="200" id="XS5"></td>
            <td><input type="text" name="start_ip" id="start_ip" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
        <tr>
            <td width="200" id="XS6"></td>
            <td><input type="text" name="end_ip" id="end_ip" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
    </table>
</div>

<div id="multiple_addrpool_div" class="cfgstep" style="display:none">
    <p><strong id="XS7"></strong></p>
    <table id="multaddrpool" >
        <tr id="start_60">
            <td width="200" id="XS9"></td>
            <td><input type="text"  id="dhcp_start_ip" name="dhcp_start_ip" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
        <tr id="end_60">
            <td width="200" id="XS10"></td>
            <td><input type="text" id="dhcp_end_ip" name="dhcp_end_ip"  maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
    </table>
    <table>
        <tr id="select_60">
            <td colspan="5" id="XS11"></td>
        </tr>
        <tr>
            <td width="10"></td>
            <td><input name="lan1" type="checkbox" id="lan1" disabled="disabled" />LAN1</td>
            <td><input name="lan2" type="checkbox" id="lan2" />LAN2</td>
            <script type="text/javascript">
            if (num_lan > 2) {
              document.write("<td><input type=\"checkbox\" name=\"lan3\" id=\"lan3\" />LAN3</td>");
              document.write("<td><input type=\"checkbox\" name=\"lan4\" id=\"lan4\" />LAN4</td>");
			}
			</script>
        </tr>
        <tr>
            <td width="10"></td>
            <td><input name="ssid1_24g" type="checkbox" id="ssid1_24g" />2.4G_SSID1</td>
            <td><input name="ssid2_24g" type="checkbox" id="ssid2_24g" />2.4G_SSID2</td>
            <td><input name="ssid3_24g" type="checkbox" id="ssid3_24g" />2.4G_SSID3</td>
            <td><input name="ssid4_24g" type="checkbox" id="ssid4_24g" />2.4G_SSID4</td>
        </tr>
        <tr id="wifi5g" style="display:none">
            <td width="10"></td>
            <td><input name="ssid1_5g" type="checkbox" id="ssid1_5g" />5G_SSID1</td>
            <td><input name="ssid2_5g" type="checkbox" id="ssid2_5g" />5G_SSID2</td>
            <td><input name="ssid3_5g" type="checkbox" id="ssid3_5g" />5G_SSID3</td>
            <td><input name="ssid4_5g" type="checkbox" id="ssid4_5g" />5G_SSID4</td>
        </tr>
        <tr id="options_add">
            <td colspan="5">
                <span id="XS23"></span>
                <a id="addpool" name="addpool" class="btn" href="#"><script>document.write(WebString.Add);</script></a>
                <input id="addrpooltable" name="addrpooltable" type="hidden" value=""  />
            </td>
        </tr>
    </table>
    <div id="MultAddrPoolTableContainer"></div>
</div>

<div id="dhcp_leasetime_div" class="cfgstep">
    <p><strong id="XS12"></strong></p>
    <table>
        <tr>
            <td width="200" id="XS13"></td>
            <td>
                <input type="text" id="time_day" name="time_day" value="1" maxlength="3" size="3" onkeypress="return OnKeyPress(event, X_INPUT_NUM);"/><script>document.write(WebString.days);</script>
                <input type="text" id="time_hour" name="time_hour" value="12" maxlength="3" size="3" onkeypress="return OnKeyPress(event, X_INPUT_NUM);"/><script>document.write(WebString.hours);</script>
                <input type="text" id="time_minu" name="time_minu" value="30" maxlength="3" size="3" onkeypress="return OnKeyPress(event, X_INPUT_NUM);"/><script>document.write(WebString.minutes);</script>
                <input id="leasetime" name="leasetime" type="hidden" value=""  /></td>
        </tr>
    </table>
</div>

<div id="dns_overwrite_div" class="cfgstep">
    <p><strong id="XS14"></strong></p>
    <table>
        <tr>
            <td width="200" id="XS15"></td>
            <td><input type="radio" name="dns_overwrite" id="dns_ovwrt0" value="1" /><script>document.write(WebString.Enable);</script>
                <input type="radio" name="dns_overwrite" id="dns_ovwrt1" value="0" checked /><script>document.write(WebString.Disable);</script></td>
        </tr>
        <tr id="primary_dns" style="display:none">
            <td width="200" id="XS16"></td>
            <td><input type="text" name="dns_primary" id="dns_primary" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
        <tr id="secondary_dns" style="display:none">
            <td id="XS17"></td>
            <td><input type="text" name="dns_secondary" id="dns_secondary" maxlength="15" onkeypress="return OnKeyPress(event, X_INPUT_IP);" /></td>
        </tr>
    </table>
</div>

<div class="cfgstep">
    <p><strong><script>document.write(WebString.stepApply);</script></strong></p>
    <a id="btn_apply" class="btn" href="#"><script>document.write(WebString.Apply);</script></a>
</div>

<% PrintTemplate3(); %>

